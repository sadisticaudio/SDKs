<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AAX SDK: Token protocol</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="aaxdoxy.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cw_105x65_aax_buf.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AAX SDK
   &#160;<span id="projectnumber">2.3.2</span>
   </div>
   <div id="projectbrief">Avid Audio Extensions Development Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Token protocol<div class="ingroups"><a class="el" href="a00793.html">AAX SDK Manual</a> &raquo; <a class="el" href="a00818.html">Additional Topics</a> &raquo; <a class="el" href="a00820.html">Parameter updates</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>Communicating parameter state with the host. </p>
<h1><a class="anchor" id="advancedTopics_parameterUpdates_tokenProtocol_contents"></a>
On this page</h1>
<ul>
<li><a class="el" href="a00822.html#tokenProtocol_introductionToTokens">An Introduction to Tokens</a> </li>
<li><a class="el" href="a00822.html#tokenProtocol_standardTokenOperation">Basic Token Operation</a></li>
</ul>
<div class="section"> </div><h1><a class="anchor" id="tokenProtocol_introductionToTokens"></a>
An Introduction to Tokens</h1>
<div class="section">One way in which a plug-in can communicate with the "outside world" is through Shared Data Services, also known as the Token System. This is a mechanism that allows Pro Tools to share parameter information with external hardware and software modules. While the AAX SDK only uses the Token System indirectly, knowing how it works will provide a good understanding of how linked parameters should operate.</div><div class="section"></div><h2><a class="anchor" id="tokenProtocol_introductionToTokens_touch"></a>
Touch</h2>
<div class="section">Touch tokens inform the system of user interaction with a parameter. When a parameter is being touched the system knows to stop sending automation data to the plug-in and just use the SET value of the parameter. It is also used to tell the system when to start/stop recording new automation data.</div><div class="section">In AAX, the touch message is sent to the host by <a class="el" href="a01773.html#a30fdb67042b8dc9fb42fa9023ed9cce0">AAX_IAutomationDelegate::PostTouchRequest()</a>. The most common way to call this method is via the following methods:</div><div class="section"><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a01825.html">AAX_IEffectParameters</a></div><div class="line">{</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="a00392.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> <a class="code" href="a01669.html#ae82e80cbfd9cb837f8101a85f06856ba">TouchParameter</a> ( <a class="code" href="a00392.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> inParameterID );</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="a00392.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> <a class="code" href="a01669.html#a2caf1b7b8e2dad62cf96f144479dee60">ReleaseParameter</a> ( <a class="code" href="a00392.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> inParameterID );</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="a01857.html">AAX_IParameter</a></div><div class="line">{</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="a01857.html#a74c71243313f9d817c8bcb77550969aa">Touch</a> ();                      </div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="a01857.html#a3d4869d9b6ec03d4f95f33f56479756f">Release</a> ();</div><div class="line">};</div></div><!-- fragment --></div><div class="section">However, AAX plug-ins will rarely need to call these methods directly since the <a class="el" href="a01537.html">AAX_CParameter</a> and <a class="el" href="a01481.html">AAX_CEffectParameters</a> implementations will automatically handle parameter touch and release tokens whenever a new value is set on the parameter by the plug-in.</div><div class="section">Other clients besides the plug-in may touch a parameter. Since the TOUCH token can come from a control surface the touch state will actually come back to the plug-in via:</div><div class="section"><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a01825.html">AAX_IEffectParameters</a></div><div class="line">{</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="a00392.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> <a class="code" href="a01669.html#a93483f44315bdf3adf60bf5bf773fbb8">UpdateParameterTouch</a> ( <a class="code" href="a00392.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> iParameterID, <a class="code" href="a00392.html#aa216506530f1d19a2965931ced2b274b">AAX_CBoolean</a> iTouchState );</div><div class="line">};</div></div><!-- fragment --></div><div class="section">This method is mainly important for <a class="el" href="a00824.html">linked parameters</a>.</div><div class="section"><div class="dotgraph">
<img class="centered" src="dot_aax_parameter_entities_touch_handled.png" alt="dot_aax_parameter_entities_touch_handled.png" border="0" usemap="#dot_aax_parameter_entities_touch_handled.map"/>
<map name="dot_aax_parameter_entities_touch_handled.map" id="dot_aax_parameter_entities_touch_handled.map"><area shape="poly" id="edge6" href="a01669.html#a93483f44315bdf3adf60bf5bf773fbb8" title="update touch\r(async)" alt="" coords="216,38,241,54,266,76,285,100,299,125,295,128,280,103,262,79,238,59,214,43"/>
<area shape="rect" id="edge6-label" href="a01669.html#a93483f44315bdf3adf60bf5bf773fbb8" title="update touch\r(async)" alt="" coords="288,77,384,115"/>
<area shape="poly" id="edge5" href="a01773.html#a30fdb67042b8dc9fb42fa9023ed9cce0" title="touch" alt="" coords="99,236,177,60,182,63,104,238"/>
<area shape="rect" id="edge5-label" href="a01773.html#a30fdb67042b8dc9fb42fa9023ed9cce0" title="touch" alt="" coords="145,154,187,173"/>
</map>
<div class="caption">
Touch request from a view controller, with resulting async touch update</div>
</div>
 </div><h2><a class="anchor" id="tokenProtocol_introductionToTokens_set"></a>
Set</h2>
<div class="section">SET tokens can come from many different locations: the plug-in GUI, a control surface, loading a chunk or automation playback. Eventually the value of a SET token comes into the plug-in and that's when the internal value of the parameter gets updated. In AAX the SET token will be sent as a result of calling the following method:</div><div class="section"><div class="fragment"><div class="line"><span class="keyword">class </span>AAX_CParemeter&lt;T&gt;</div><div class="line">{</div><div class="line">    <span class="keywordtype">void</span> SetValue ( T newValue );</div><div class="line">};</div></div><!-- fragment --></div><div class="section">which will be called from many other supporting methods:</div><div class="section"><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a01537.html">AAX_CParameter</a>&lt;T&gt;</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> <a class="code" href="a01537.html#a2089ea0d243087c562ce8b1bd89a495a">SetValueWithBool</a> ( <span class="keywordtype">bool</span> value );</div><div class="line">    <span class="keywordtype">bool</span> <a class="code" href="a01537.html#aaf45f020a267f894429b4a75ddbe9c6c">SetValueWithInt32</a> ( int32_t value );</div><div class="line">    <span class="keywordtype">bool</span> <a class="code" href="a01537.html#ab3f589671d20c826859b4398e96ee9bb">SetValueWithFloat</a> ( <span class="keywordtype">float</span> value );</div><div class="line">    <span class="keywordtype">bool</span> <a class="code" href="a01537.html#a7551c4071f91cb48103b5a8dda8f73eb">SetValueWithDouble</a> ( <span class="keywordtype">double</span> value );</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="a01537.html#a9ae87f0a8655c68ac7c59bec3f476c48">SetToDefaultValue</a> ();</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="a01537.html#ac4f8ae8c5ecb2cd04ebc3aa2523449f7">SetNormalizedValue</a> ( <span class="keywordtype">double</span> normalizedNewValue );</div><div class="line">    <span class="keywordtype">bool</span> <a class="code" href="a01537.html#aa9194daefda8f6491849819fb25a73d2">SetValueFromString</a> ( <span class="keyword">const</span> <a class="code" href="a01573.html">AAX_CString</a> &amp; newValueString );</div><div class="line">};</div></div><!-- fragment --></div><div class="section">When a SET token enters the system from the GUI, control surface or automation the value comes bak to the plug-in via the following method:</div><div class="section"><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a01481.html">AAX_CEffectParameters</a></div><div class="line">{</div><div class="line">    <a class="code" href="a00392.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> <a class="code" href="a01481.html#aeff79c1e5cc6b65c7ed21d9912f87caf">UpdateParameterNormalizedValue</a> ( <a class="code" href="a00392.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> iParameterID, <span class="keywordtype">double</span> aValue, <a class="code" href="a00491.html#a30be0398faf20c6b121239eb9399f3f7">AAX_EUpdateSource</a> inSource);</div><div class="line">};</div></div><!-- fragment --></div><div class="section">At this point the internal contents of the plug-in are set.</div><div class="section"><div class="dotgraph">
<img class="centered" src="dot_aax_parameter_entities_update.png" alt="dot_aax_parameter_entities_update.png" border="0" usemap="#dot_aax_parameter_entities_update.map"/>
<map name="dot_aax_parameter_entities_update.map" id="dot_aax_parameter_entities_update.map"><area shape="poly" id="edge6" href="a01669.html#a685858711efb8634ce66c327f2865c71" title="update value\r(async)" alt="" coords="359,77,365,108,364,142,362,153,357,152,359,141,359,109,354,78"/>
<area shape="rect" id="edge6-label" href="a01669.html#a685858711efb8634ce66c327f2865c71" title="update value\r(async)" alt="" coords="361,104,456,141"/>
<area shape="poly" id="edge5" href="a01773.html#a9d0e2c5d57d177a4dca0ff10cde0256c" title="set" alt="" coords="112,263,304,80,308,83,116,267"/>
<area shape="rect" id="edge5-label" href="a01773.html#a9d0e2c5d57d177a4dca0ff10cde0256c" title="set" alt="" coords="219,181,239,199"/>
</map>
<div class="caption">
Set token asynchronously changes state of the parameter data</div>
</div>
 </div><h2><a class="anchor" id="tokenProtocol_introductionToTokens_update"></a>
Update</h2>
<div class="section">An update token is generated when the internal value of a parameter has been set. GUIs and control surfaces listen for UPDATE tokens to update the displayed values. In AAX the UPDATE token is sent by calling the following method:</div><div class="section"><div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a01537.html">AAX_CParameter</a>&lt;T&gt;</div><div class="line">{</div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="a01537.html#a8a70b3c8bcff486c18e9a6e5c8ce4dda">UpdateNormalizedValue</a> ( <span class="keywordtype">double</span> newNormalizedValue );</div><div class="line">};</div></div><!-- fragment --></div><div class="section">All views of the parameter are then asynchronously notified that the value has changed. The plug-in GUI is notified via a call to <a class="el" href="a01665.html#a45b468fef806611581f748af9301ab4d">AAX_IEffectGUI::ParameterUpdated()</a>.</div><div class="section"><div class="dotgraph">
<img class="centered" src="dot_aax_parameter_entities_curvalue.png" alt="dot_aax_parameter_entities_curvalue.png" border="0" usemap="#dot_aax_parameter_entities_curvalue.map"/>
<map name="dot_aax_parameter_entities_curvalue.map" id="dot_aax_parameter_entities_curvalue.map"><area shape="poly" id="edge6" href="a01665.html#a45b468fef806611581f748af9301ab4d" title="update\r(async)" alt="" coords="324,41,272,71,245,94,225,121,217,141,212,163,212,205,206,205,207,162,212,140,220,119,241,90,268,67,322,37"/>
<area shape="rect" id="edge6-label" href="a01665.html#a45b468fef806611581f748af9301ab4d" title="update\r(async)" alt="" coords="221,126,276,163"/>
<area shape="poly" id="edge7" href="a01665.html#a45b468fef806611581f748af9301ab4d" title="update\r(async)" alt="" coords="381,30,427,44,449,57,466,76,474,92,474,108,461,135,445,162,442,177,444,194,450,208,445,210,439,195,437,177,440,160,456,132,468,106,468,93,462,79,445,62,425,49,380,36"/>
<area shape="rect" id="edge7-label" href="a01665.html#a45b468fef806611581f748af9301ab4d" title="update\r(async)" alt="" coords="465,126,520,163"/>
<area shape="poly" id="edge8" href="a01665.html#a45b468fef806611581f748af9301ab4d" title="update\r(async)" alt="" coords="377,33,430,48,487,75,517,102,541,136,557,172,568,205,563,207,552,174,536,139,513,106,484,80,428,53,376,38"/>
<area shape="rect" id="edge8-label" href="a01665.html#a45b468fef806611581f748af9301ab4d" title="update\r(async)" alt="" coords="552,126,607,163"/>
<area shape="poly" id="edge5" href="a01773.html#a20cb518bb470b6f4cadf58e4af64ac96" title="current value" alt="" coords="354,120,358,99,359,78,355,63,361,61,364,77,364,100,359,121"/>
<area shape="rect" id="edge5-label" href="a01773.html#a20cb518bb470b6f4cadf58e4af64ac96" title="current value" alt="" coords="361,77,459,96"/>
</map>
<div class="caption">
Update token triggers async updates to all views</div>
</div>
</div><div class="section"> </div><h1><a class="anchor" id="tokenProtocol_standardTokenOperation"></a>
Basic Token Operation</h1>
<div class="section">The lists below indicate how the system works in a few different standard update scenarios. To enable logging for these events set <code>DTF_AUTOMATION=file@DTP_LOW</code> in the <a class="el" href="a00834.html">DigiTrace</a> configuration file. For more detailed information about the sequence of calls used to update parameters in different situations, see <a class="el" href="a00823.html">Basic parameter update sequences</a>.</div><div class="section"></div><h2><a class="anchor" id="tokenProtocol_standardTokenOperation_userEditing"></a>
User Editing</h2>
<div class="section"><ol type="1">
<li>User clicks on a parameter in the GUI or grabs a parameter on the controls surface. A TOUCH token should be sent at this point.</li>
<li>The user changes the parameter from the GUI or controls surface. A SET token should be sent at this point.</li>
<li>The SET token goes into the system and comes back to the plugin via UpdateParameterNormalizedValue().</li>
<li>The plug-in updates it's internal state and sends an UPDATE token.</li>
<li>Repeat steps 2-4 while changing the parameter.</li>
<li>The user lets go of the GUI or controls surface. A TOUCH token with the released state should be sent.</li>
</ol>
</div><div class="section"></div><h2><a class="anchor" id="tokenProtocol_standardTokenOperation_automationPlayback"></a>
Automation Playback</h2>
<div class="section"><ol type="1">
<li>The SET token comes from the automation system and enters the plugin via UpdateParameterNormalizedValue().</li>
<li>The plug-in updates it's internal state and sends an UPDATE token.</li>
<li>Repeat steps 1-2 while playing back automation.</li>
</ol>
</div><div class="section"></div><h2><a class="anchor" id="tokenProtocol_standardTokenOperation_chunkRestoring"></a>
Chunk Restoring</h2>
<div class="section"><ol type="1">
<li>Plug-in loads the chunk.</li>
<li>The plug-in sets every parameters value. Another thing to note is that the</li>
<li>SetValue() method also contains Touch() and Release() calls. So, while setting every parameter there is a combination of TOUCH and SET tokens sent to the system.</li>
<li>The SET tokens comes back to the plugin via UpdateParameterNormalizedValue().</li>
<li>The plug-in updates it's internal state and sends out UPDATE tokens.</li>
</ol>
</div><div class="section"></div> <div class="dynheader">
Collaboration diagram for Token protocol:</div>
<div class="dyncontent">
<center><table><tr><td><img src="a00822.png" border="0" alt="" usemap="#a00822"/>
<map name="a00822" id="a00822">
<area shape="rect"  href="a00820.html" title="The anatomy of a parameter update." alt="" coords="5,5,140,29"/>
<area shape="rect"  title="Communicating parameter state with the host." alt="" coords="188,5,296,29"/>
</map>
</td></tr></table></center>
</div>
</div><!-- contents -->
<!--        Copyright 2016, 2018 by Avid Technology, Inc.        -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<div class="FooterLegal">This product may be protected by one or more U.S. and non-U.S. patents. Details are available at <a href="https://www.avid.com/patents">www.avid.com/patents</a>.</div>
Generated on Sun Jun 6 2021 15:21:29 for AAX SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
